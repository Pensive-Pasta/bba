---
import ChevronDown from "../assets/icons/chevron-down.svg";
const { image = "", id = "" } = Astro.props;
---

<section
  class={`w-full bg-[url('${image}')] bg-cover bg-center bg-blend-color-burn h-screen flex items-center justify-center`}
  style={`background-image: url('${image}'); background-size: cover; background-position: center;`}
>
  <a
    href={`#${id}`}
    class="absolute bottom-6 md:bottom-12 right-6 md:right-12"
    data-target={id}
  >
    <ChevronDown class="animate-bounce w-16 text-white" />
  </a>
</section>

<script>
  function initSmoothScroll() {
    const targetId = document.querySelector("a[data-target]")?.getAttribute("data-target");
    let fired = false;

    function smoothJump() {
      if (targetId) {
        const el = document.getElementById(targetId);
        if (el) el.scrollIntoView({ behavior: "smooth" });
      }
    }

    function onScroll() {
      const y = window.scrollY;

      if (!fired && y > 10) {
        fired = true;
        smoothJump();
      }

      if (fired && y < 10) {
        fired = false;
      }
    }

    onScroll();
    window.addEventListener("scroll", onScroll, { passive: true });

    document.addEventListener("astro:before-swap", () => {
      window.removeEventListener("scroll", onScroll);
      fired = false;
    });
  }

  // Run on initial load
  initSmoothScroll();

  // Re-run on client-side navigation
  document.addEventListener("astro:page-load", initSmoothScroll);
</script>
