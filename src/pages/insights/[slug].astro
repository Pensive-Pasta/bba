---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageDotGrid from "../../components/PageDotGrid.astro";
import ContentBlock from "../../components/ContentBlock.astro";
import { sanity } from "../../lib/sanityClient";
import { getInsightBySlugQuery } from "../../lib/queries";

const { slug } = Astro.params;

export async function getStaticPaths() {
  const insights = await sanity.fetch(
    `*[_type == "insight"]{ "slug": slug.current }`
  );
  return insights.map((i: { slug: string }) => ({ params: { slug: i.slug } }));
}

const insight = await sanity.fetch(getInsightBySlugQuery, { slug });

const seoTitle = insight.title
  ? `${insight.title} | Insights | BBA`
  : `Untitled Insight | BBA`;
---

<BaseLayout title={seoTitle}>
  <PageDotGrid />
  <article class="max-w-[1600px] mx-auto pb-20 pt-[200px] min-h-[60vh]">
    <h1 class="text-3xl md:text-4xl font-bold mb-4 px-4 md:px-8 md:w-1/2">{insight.title}</h1>
    <p class="text-muted text-sm mb-12 px-4 md:px-8">
      {new Date(insight.publishedAt).toLocaleDateString()}
    </p>
    <div class="mt-12 md:-mt-32">
    <ContentBlock blocks={insight.contentBlocks} />
    </div>
  </article>
</BaseLayout>
