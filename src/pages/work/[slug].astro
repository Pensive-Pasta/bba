---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageDotGrid from "../../components/PageDotGrid.astro";
import Hero from "../../components/Hero.astro";
import { sanity } from "../../lib/sanityClient";
import { getProjectBySlugQuery } from "../../lib/queries";

const { slug } = Astro.params;

export async function getStaticPaths() {
  const projects = await sanity.fetch(
    `*[_type == "project"]{ "slug": slug.current }`
  );
  return projects.map((p: { slug: any }) => ({ params: { slug: p.slug } }));
}

const projectInfo = await sanity.fetch(getProjectBySlugQuery, { slug });
---

<BaseLayout title={projectInfo.title}>
  <PageDotGrid />
  <article class="min-h-[60vh]">
    {
      projectInfo.imageUrl && (
        <Hero
          image={projectInfo.imageUrl}
          alt={projectInfo.altText}
          scrollTarget="projects"
        />
      )
    }
    <section class="p-4 md:p-8 my-36">
      <dl class="grid grid-cols-[auto_1fr] gap-x-4 gap-y-2 text-primary">
        {
          projectInfo.title && (
            <>
              <dt class="font-medium">Name:</dt>
              <dd class="font-bold text-xl">{projectInfo.title}</dd>
            </>
          )
        }
        {
          projectInfo.postCode && (
            <>
              <dt class="font-medium">Postcode:</dt>
              <dd class="font-bold text-xl">{projectInfo.postCode}</dd>
            </>
          )
        }
        {
          projectInfo.county && (
            <>
              <dt class="font-medium">County:</dt>
              <dd class="font-bold text-xl">{projectInfo.county}</dd>
            </>
          )
        }
        {
          projectInfo.site && (
            <>
              <dt class="font-medium">Site:</dt>
              <dd class="font-bold text-xl">{projectInfo.site}</dd>
            </>
          )
        }
        {
          projectInfo.type && (
            <>
              <dt class="font-medium">Typology:</dt>
              <dd class="font-bold text-xl">{projectInfo.type}</dd>
            </>
          )
        }
      </dl>
    </section>
  </article>
</BaseLayout>
