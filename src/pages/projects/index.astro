---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import SectionWrapper from "../../layouts/SectionWrapper.astro";
import Hero from "../../components/Hero.astro";

const projects = [
  {
    title: "Wrap Around House",
    location: "Cambridge",
    category: "Residential",
    year: "2023",
    image:
      "/images/bba-018-wrap_around_house-complete-copyright_msap-16-900x900.jpg",
    slug: "wrap-around-house",
    type: "urban",
  },
  {
    title: "Copper House",
    location: "Cambridge",
    category: "Residential",
    year: "2024",
    image: "/images/copper.jpg",
    slug: "copper-house",
    type: "urban",
  },
  {
    title: "Western Park",
    location: "Leicester",
    category: "Cultural",
    year: "2025",
    image: "/images/westernpark.jpg",
    slug: "western-park",
    type: "rural",
  },
  {
    title: "Test 4",
    location: "Test 5",
    category: "Test 6",
    year: "2022",
    image: "/images/placeholder.jpg",
    slug: "riverside-gallery",
    type: "rural",
  },
  {
    title: "Test 10",
    location: "Test 11",
    category: "Test 12",
    year: "2022",
    image: "/images/placeholder.jpg",
    slug: "urban-apartment",
    type: "urban",
  },
  {
    title: "Test 13",
    location: "Test 14",
    category: "Test 15",
    year: "2021",
    image: "/images/placeholder.jpg",
    slug: "community-hub",
    type: "rural",
  },
  {
    title: "Test 16",
    location: "Test 17",
    category: "Test 18",
    year: "2022",
    image: "/images/placeholder.jpg",
    slug: "garden-studio",
    type: "urban",
  },
  {
    title: "Test 19",
    location: "Test 20",
    category: "Test 21",
    year: "2021",
    image: "/images/placeholder.jpg",
    slug: "timber-house",
    type: "urban",
  },
  {
    title: "Test 22",
    location: "Test 23",
    category: "Test 24",
    year: "2020",
    image: "/images/placeholder.jpg",
    slug: "eco-house",
    type: "urban",
  },
  {
    title: "Test 25",
    location: "Test 26",
    category: "Test 27",
    year: "2021",
    image: "/images/placeholder.jpg",
    slug: "office-renovation",
    type: "rural",
  },
  {
    title: "Test 28",
    location: "Test 29",
    category: "Test 30",
    year: "2022",
    image: "/images/placeholder.jpg",
    slug: "riverside-gallery",
    type: "rural",
  },
  {
    title: "Test 31",
    location: "Test 32",
    category: "Test 33",
    year: "2022",
    image: "/images/placeholder.jpg",
    slug: "urban-apartment",
    type: "urban",
  },
];
---

<BaseLayout title="Projects">
  <Hero image="/images/copper.jpg" scrollTarget="projects" />
  <SectionWrapper id="projects">
    <p class="my-40 w-1/2 ml-auto">
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Fugiat, modi enim
      eligendi reiciendis perspiciatis perferendis, quisquam ad, tenetur dolore
      necessitatibus sed? Esse magni quam, saepe minima earum porro vitae
      possimus!
    </p>
    <div class="flex flex-row justify-between mb-4 md:mb-8">
      <h3 class="current-heading text-2xl mb-4 md:mb-0 relative z-10">
        <button id="index-toggle" class="">Index</button>
      </h3>
    </div>
    <!-- hidden radio buttons used for filtering -->
    <input type="radio" id="urban" name="project-filter" class="sr-only" />
    <input
      type="radio"
      id="both"
      name="project-filter"
      class="sr-only"
      checked
    />
    <input type="radio" id="rural" name="project-filter" class="sr-only" />

    <div
      class="toggle-wrapper flex md:justify-end relative md:ml-2 items-center -top-4 md:-top-16"
    >
      <span class="urban-heading text-2xl mr-4">Urban</span>

      <div class="project-slider relative w-72 h-3 bg-gray-300 rounded-full">
        <div
          class="slider-thumb absolute top-1/2 left-0 h-6 w-6 bg-black rounded-full -translate-y-1/2 transition-[left] duration-300"
        >
        </div>

        <label
          for="urban"
          class="absolute left-0 top-0 w-1/3 h-full cursor-pointer"
        >
          <span class="sr-only">Urban</span>
        </label>
        <label
          for="both"
          class="absolute left-1/3 top-0 w-1/3 h-full cursor-pointer"
        >
          <span class="sr-only">Urban & Rural</span>
        </label>
        <label
          for="rural"
          class="absolute left-2/3 top-0 w-1/3 h-full cursor-pointer"
        >
          <span class="sr-only">Rural</span>
        </label>
      </div>

      <span class="rural-heading text-2xl ml-4">Rural</span>
    </div>

    <div
      class="project-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
    >
      {
        projects.map((project) => (
          <div class="card" data-type={project.type}>
            <ProjectCard {...project} />
          </div>
        ))
      }
    </div>

    <div id="project-index" class="hidden">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr>
            <th class="border-b pb-2">Name</th>
            <th class="border-b pb-2">Location</th>
            <th class="border-b pb-2">Category</th>
          </tr>
        </thead>
        <tbody>
          {
            projects.map((project) => (
              <tr>
                <td class="py-2">
                  <a href={`/projects/${project.slug}`} class="">
                    {project.title}
                  </a>
                </td>
                <td class="py-2">{project.location}</td>
                <td class="py-2">{project.category}</td>
              </tr>
            ))
          }
        </tbody>
      </table>
    </div>
  </SectionWrapper>

  <style>
    /* --- Project filtering --- */
    #urban:checked ~ .project-grid .card[data-type="rural"] {
      display: none;
    }
    #rural:checked ~ .project-grid .card[data-type="urban"] {
      display: none;
    }

    /* --- Slider knob movement --- */
    .slider-thumb {
      transform: translate(-50%, -50%);
    }
    #urban:checked ~ .toggle-wrapper .slider-thumb {
      left: 0%;
    }
    #both:checked ~ .toggle-wrapper .slider-thumb {
      left: 50%;
    }
    #rural:checked ~ .toggle-wrapper .slider-thumb {
      left: 100%;
    }

    /* --- Dynamic heading text --- */
    .current-heading span {
      display: none;
    }
    #urban:checked ~ .current-heading .urban-heading {
      display: inline;
    }
    #both:checked ~ .current-heading .both-heading {
      display: inline;
    }
    #rural:checked ~ .current-heading .rural-heading {
      display: inline;
    }
  </style>

  <script is:inline>
    /**
     * Grid / Index toggle
     * — binds once
     * — resets view on each Astro client navigation
     */
    const initProjectToggle = () => {
      const btn = document.getElementById("index-toggle");
      const grid = document.querySelector(".project-grid");
      const indexTable = document.getElementById("project-index");
      const toggleWrap = document.querySelector(".toggle-wrapper");

      if (!btn || !grid || !indexTable) return;
      if (btn.dataset.bound) return; // avoid duplicate listeners
      btn.dataset.bound = "true";

      const resetView = () => {
        grid.classList.remove("hidden");
        indexTable.classList.add("hidden");
        toggleWrap?.classList.remove("hidden", "md:hidden");
      };

      // first paint
      resetView();

      // click-toggle
      btn.addEventListener("click", () => {
        grid.classList.toggle("hidden");
        indexTable.classList.toggle("hidden");
        toggleWrap?.classList.toggle("hidden");
        toggleWrap?.classList.toggle("md:hidden");
      });
    };

    // run on first load
    if (document.readyState !== "loading") {
      initProjectToggle();
    } else {
      document.addEventListener("DOMContentLoaded", initProjectToggle);
    }

    // run again after every Astro SPA navigation
    document.addEventListener("astro:page-load", initProjectToggle);
  </script>
</BaseLayout>
